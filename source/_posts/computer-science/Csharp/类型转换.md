---
title: 类型转换
date: 2024-10-21 10:51:13
category:
  - [计算机与科学, C#]
tags: C#
cover: https://daiblog.oss-cn-chengdu.aliyuncs.com/cover/2-4.jpg
---

# 隐式（implicit）类型转换

编译器自动进行类型转换

## 不丢失精度的转换

《C# 定义文档》6.1.2 隐式数值转换

**隐式数值转换为：**

- sbyte ➡ short、int、long、float、double 或 decimal
- byte ➡ short、ushort、int、uint、long、ulong、float、double 或 decimal
- short ➡ int、long、float、double 或 decimal
- ushort ➡ int、uint、long、ulong、float、double 或 decimal
- int ➡ long、float、double 或 decimal
- uint ➡ long、ulong、float、double 或 decimal
- long ➡ float、double 或 decimal
- ulong ➡ float、double 或 decimal
- char ➡ ushort、int、uint、long、ulong、float、double 或 decimal
- float ➡ double

+++success 示例

```csharp
int x = int.MaxValue;
long y = x;
Console.WriteLine(y);
```

+++

## 子类向父类的转换

面向对象编程的一个核心概念 —— “多态”（polymorphism），多态就基于面向对象语言支持子类向父类的隐式转换

+++success 示例

```csharp
class Program
{
  static void Main(string[] args)
  {
    Teacher t = new Teacher();
    Human h = t; // 当t转换为h后，在h里面就只能访问到Human类能访问的成员，不能再访问Teach方法
    Animal a = h;
    a.Eat();
  }
}

class Animal
{
  public void Eat()
  {
    Console.WriteLine("Eating...");
  }
}

class Human : Animal
{
  public void Think()
  {
    Console.WriteLine("Who i am?");
  }
}

class Teacher : Human
{
  public void Teach()
  {
    Console.WriteLine("I teach programmming");
  }
}
```

+++

## 装箱

# 显式（explicit）类型转换

## 有可能丢失精度（甚至发生错误）的转换，即 cast

《C# 定义文档》6.2.1 显式数值转换
显式数值转换是指从一个 numeric-type 到另一个 numeric-type 的转换，此转换不能用已知的隐式数值转换（第 6.1.2 节）实现，它包括：

- sbyte ➡ byte、ushort、uint、ulong 或 char
- byte ➡ sbyte 和 char
- short ➡ sbyte、byte、ushort、uint、ulong 或 char
- ushort ➡ sbyte、byte、short 或 char
- int ➡ sbyte、byte、short、ushort、uint、ulong 或 char
- uint ➡ sbyte、byte、short、ushort、int 或 char
- long ➡ sbyte、byte、short、ushort、int、uint、ulong 或 char
- ulong ➡ sbyte、byte、short、ushort、int、uint、long 或 char
- char ➡ sbyte、byte 或 short
- float ➡ sbyte、byte、short、ushort、int、uint、long、ulong、char 或 decimal
- double ➡ sbyte、byte、short、ushort、int、uint、long、ulong、char、float 或 decimal
- decimal ➡ sbyte、byte、short、ushort、int、uint、long、ulong、char、float 或 double

+++success 示例

```csharp
Console.WriteLine(ushort.MaxValue); // max ushort = 65535
uint x = 65536;
ushort y = (ushort)x;
Console.WriteLine(y); // y = 0
```

+++

## 拆箱

## 使用 Convert 类

```csharp
double x = System.Convert.ToDouble(tb1.text);
double y = System.Convert.ToDouble(tb2.text);
double result = x + y;

tb3.Text = Convert.ToString(result);
// or
tb3.Text = result.ToString();
```

## ToString 方法与各数据类型的 Parse/TryParse 方法

C# 的所有数据类型都源自于 Object 类，而 Object 类就有 ToString 方法，即 C# 中所有类型都有 ToString 方法

```csharp
// Parse 只能解析格式正确的字符串数据类型
double x = double.Parse(tb1.Text);
double y = double.Parse(tb2.Text);
double result = x + y;
tb3.Text = result.ToString();


// TryParse
double x;
if (double.TryParse(tb1.Text,out x))
{
  double y = Convert.ToDouble(tb2.Text);
  double result = x + y;
  tb3.Text = result.ToString();
}
```

# 自定义类型转换操作符

+++success 示例：显式类型 —— 让石头类支持显式转换为猴子

```csharp
class Program
{
  static void Main(string[] args)
  {
    Stone stone = new Stone();
    stone.Age = 5000;

    Monkey wukongSun = (Monkey)stone;
    Cossnsole.WriteLine(wukongSun.Age); // 10
  }
}

class Stone
{
  public int Age;

  // 转换器写在被转换类型里面
  public static explicit operator Monkey(Stone stone)
  {
    Monkey m = new Monkey()
    m.Age = stone.Age / 500;
    return m;
  }
}

class Monkey
{
  public int Age;
}
```

+++

+++success 示例：隐式类型

```csharp
class Program
{
  static void Main(string[] args)
  {
    Stone stone = new Stone();
    stone.Age = 5000;

    Monkey wukongSun = stone;
    Cossnsole.WriteLine(wukongSun.Age); // 10
  }
}

class Stone
{
  public int Age;

  // 转换器写在被转换类型里面
  public static implicit operator Monkey(Stone stone)
  {
    Monkey m = new Monkey()
    m.Age = stone.Age / 500;
    return m;
  }
}

class Monkey
{
  public int Age;
}
```

+++
